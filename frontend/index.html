<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dua Educational Portal ‚Äî Complete (Fixed Storage)</title>
  <style>
    :root{
      --bg: linear-gradient(135deg,#16d2e7,#06434b);
      --card:#f7f8f9;
      --accent:#4f05fd;
      --accent2:#f404a0;
      --accent3:#f5f4f67e;
      --muted:#1368df35;
      --radius:10px;
      --max:auto;
      --shadow: 0 8px 20px rgba(16, 84, 244, 0.08);
      font-family: Inter, system-ui, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:#011a2a}
    .wrap{max-width:1200px;margin:10px auto;padding:12px}
    header{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:8px;border-radius:6px;box-shadow:var(--shadow)}
    .brand{display:flex;align-items:center;gap:15px}
    .brand img{width:36px;height:36px;border-radius:8px;object-fit:cover}
    .brand h1{font-size:18px;margin:0;color:#fff}
    nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    nav a{color:#f5f5f3;text-decoration:none;padding:6px 8px;border-radius:8px;cursor:pointer;font-weight:600}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:12px}
    .card{background:var(--card);padding:18px;border-radius:10px;box-shadow:var(--shadow)}
    h2{margin:0 0 10px 0;color:var(--accent)}
    label{display:block;font-weight:500;margin-bottom:6px;color:#334155}
    input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(6,40,61,0.06);margin-bottom:5px;font-size:12px}
    input:focus,select:focus,textarea:focus{outline:2px solid rgba(79,70,229,0.12);border-color:rgba(79,70,229,0.2)}
    .btn-row{display:flex;gap:8px}
    .btn{cursor:pointer;border:none;padding:10px 12px;border-radius:8px;font-weight:700}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff}
    .btn-ghost{background:transparent;border:2px solid var(--accent);color:var(--accent)}
    .small{font-size:11px;color:#64748b}
    .result-row{padding:10px;border-radius:8px;background:#f8fafc;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .table{width:100%;border-collapse:collapse;margin-top:12px}
    .table th,.table td{border:1px solid #e6eef6;padding:8px;background:white;text-align:left}
    .table th{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff}
    .hidden{display:none}
    .stu-photo{width:96px;height:96px;border-radius:8px;object-fit:cover;border:2px solid rgba(0,0,0,0.04)}
    .confirm-box{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(180deg,#ecfeff,#f0f9ff);border:1px solid rgba(6,40,61,0.04)}
    @media (max-width:980px){.layout{grid-template-columns:1fr}}
    .admin-img { width:60px;height:60px;border-radius:6px;object-fit:cover;border:1px solid #ddd }
    .toast { position: fixed; right: 20px; bottom: 20px; background: #0f766e; color: white; padding: 12px 16px; border-radius: 8px; box-shadow: 0 6px 18px rgba(215, 36, 36, 0.12); z-index: 9999; display:none; }
    .teachers-container{ display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:25px; }
    .teacher-card{ width: calc((100% - 40px) / 3); max-width: 200px; text-align: center; background: #fff; border-radius: 12px; padding: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .teacher-card img{ width: 160px; height:160px; object-fit:cover; border-radius:50%; display:block; margin:auto; }
    .teacher-name{ font-weight:bold; font-size:1rem; color:var(--accent) }
    .teacher-subject{ font-size:0.9rem; color:var(--muted) }
    .teacher-gallery{ display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px }
    .teacher-gallery img{ width:220px;height:210px;object-fit:cover;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,0.06) }
    @media (max-width:640px){ .teacher-card{ width: calc(50% - 10px); max-width: 45vw; } .teacher-card img{ width:120px;height:120px; } }
    .slip-wrapper{ border:3px solid #0077ff; padding:25px; border-radius:12px; background:white; }
    .slip-header{text-align:center;margin-bottom:18px}
    .academy-logo{width:40px}
    .academy-title{font-size:24px;font-weight:800;color:#00306e}
    .slip-box{display:flex;gap:20px;background:#eaf3ff;padding:20px;border-radius:12px}
    .left-photo{width:140px}
    .stu-photo{width:140px;height:160px;object-fit:cover;border:2px solid #00306e;border-radius:10px}
    .data{ flex:1; }
    .slip-heading{font-size:20px;margin-bottom:10px;color:#00306e;font-weight:700}
    .field{margin:4px 0;font-size:15px}
    .small-heading{margin-top:10px;font-size:16px;color:#00306e;font-weight:600}
    .roll-style{font-size:18px;padding:3px 10px;color:white;background:#0077ff;border-radius:8px;font-weight:700}
    .sign-row{margin-top:25px;display:flex;justify-content:space-between;padding:0 20px}
    .sign-img{width:140px;opacity:0.9}
    .stamp-img{width:120px;opacity:0.9}
    .sign-text{text-align:center;font-size:14px;margin-top:5px;font-weight:600}
    @media print{ body{ background:rgb(218, 34, 34); } .slip-wrapper{ box-shadow:none; } }
    .small-card { width: 220px; background: #f8e1e1; border-radius: 14px; overflow: hidden; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin: 12px; font-family: sans-serif; }
    .small-card .card-header { background: #2404f4; color: #f7f6f6; padding: 10px; font-size: 18px; font-weight: 800; }
    .small-card .name { font-weight: 800; margin-top: 10px; color: #333; }
    .call-btn { background: #28a745; color:rgb(246, 242, 242); text-decoration:none; display:inline-block; padding:8px 12px; border-radius:25px; }
    .wa-btn { background: #25D366; color:white; text-decoration:none; display:inline-block; padding:8px 12px; border-radius:25px; }
    /* Modal styles */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,0.6); display:none; align-items:center; justify-content:center; z-index:9998; }
    .modal{ width:420px; max-width:95%; background:rgb(228, 197, 197); border-radius:12px; padding:18px; box-shadow:0 10px 30px rgba(2,6,23,0.3) }
    .modal h3{ margin-top:0 }
    .demo-steps{ display:flex; gap:8px; margin-top:12px }
    .badge{ display:inline-block; padding:6px 8px; border-radius:8px; background:#eef2ff; color:#4338ca; font-weight:700 }
  }
    /* --- Basic page (for demo) --- */
    body{
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(135deg,#f0f6fb,#e9f7ef);
      color:#0b2340;
    }

    .container {
      max-width:920px;
      width:100%;
      padding:24px;
      box-sizing:border-box;
      text-align:center;
    }

    h1{ margin:0 0 12px; font-size:22px; }
    p{ margin:0 0 20px; color:rgb(232, 9, 158); opacity:.8 }

    /* --- Floating social bar --- */
    .social-bar {
      position: fixed;
      right: 18px;
      bottom: 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:9999;
      align-items:center;
    }

    .social-btn {
      width:56px;
      height:56px;
      border-radius:50%;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 6px 18px rgba(9, 84, 232, 0.12);
      transition: transform .12s ease, box-shadow .12s ease;
      text-decoration:none;
      background:rgb(232, 10, 158);
      border: none;
      cursor: pointer;
      position:relative;
      overflow:visible;
    }

    .social-btn:hover{ transform: translateY(-4px); box-shadow:0 12px 28px rgba(10,20,40,0.18) }

    /* icon sizes */
    .social-btn svg{ width:28px; height:28px; display:block }

    /* Facebook color theme */
    .facebook{
      background: linear-gradient(180deg,#ffffff,#f3f6fb);
      color: #1877f2; /* facebook blue for icon fill */
      border: 1px solid rgba(24,119,242,0.08);
    }

    /* WhatsApp green */
    .whatsapp{
      background: linear-gradient(180deg,#ffffff,#f7fff9);
      color: #f00aab; /* whatsapp green for icon */
      border: 1px solid rgba(37,211,102,0.08);
    }

    /* tooltip */
    .tooltip {
      position:absolute;
      right:70px;
      top:50%;
      transform:translateY(-50%) scale(.96);
      background:#0b2340;
      color:white;
      padding:8px 10px;
      border-radius:8px;
      box-shadow:0 8px 20px rgba(237, 8, 8, 0.12);
      white-space:nowrap;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition: all .14s ease;
      transform-origin:right center;
    }

    .social-btn:focus .tooltip,
    .social-btn:hover .tooltip {
      opacity:1;
      transform:translateY(-50%) scale(1);
      pointer-events:auto;
    }

    .tooltip::after{
      content:"";
      position:absolute;
      right:-6px;
      top:50%;
      transform:translateY(-50%);
      width:0;height:0;
      border-top:6px solid transparent;
      border-bottom:6px solid transparent;
      border-left:6px solid #0b2340;
    }

    @media (max-width:420px){
      .social-btn{ width:48px; height:48px }
      .tooltip{ right:60px; font-size:12px; padding:7px 9px }
    }

    .footer-links{
      margin-top:18px;
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
    }
    .footer-links a{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:8px;
      text-decoration:none;
      color:inherit;
      background:rgba(190, 6, 246, 0.6);
      border:1px solid rgba(163, 5, 5, 0.04);
    }
    .footer-links svg{ width:18px; height:18px }
  </style>
</head>
<body>
<div class="wrap">

  <header>
    <div class="brand">
      <img id="siteLogo" src="logo dua Academy kamoon shaheed.PNG" alt="Logo" onerror="this.style.display='none'">
      <div>
        <h1>Dua Educational Academy</h1>
        <div class="small" style="color:rgba(48, 15, 216, 0.9)">Kamoon Shaheed - Online Portal</div>
      </div>
    </div>
    <nav>
      <a onclick="openSection('home')">Home</a>
      <a onclick="openSection('apply')">Apply</a>
      <a onclick="openSection('slip')">Slip</a>
      <a onclick="openSection('result')">Result</a>
      <a onclick="openSection('admin')">Admin</a>
      <a onclick="openSection('marksUpload')">Upload Marks</a>
    </nav>
  </header>

  <main class="layout">
    <section id="home" class="card home-card">
      <div style="text-align:center; padding:10px;">
        <img src="logo dua Academy kamoon shaheed.PNG" width="220" height="220" style="border-radius:10px;" alt="Academy Logo" onerror="this.style.display='none'">
        <h2 style="font-size:22px; text-align:center; margin-bottom:10px;">Welcome to Dua Educational Academy Kamoon Shaheed</h2>
        <p class="home-desc" style="text-align:center; font-size:14px;">Official Online Portal ‚Äî Auto Roll ‚Ä¢ Apply ‚Ä¢ Slip ‚Ä¢ Result ‚Ä¢ Admin</p>
      </div>

      <div style="display:flex;justify-content:center;gap:8px;margin-top:8px;">
        <button class="btn btn-primary" onclick="openSection('apply')" style="width:auto;">Apply</button>
        <button class="btn btn-primary" onclick="openSection('slip')" style="width:auto;">Slip</button>
        <button class="btn btn-primary" onclick="openSection('result')" style="width:auto;">Result</button>
        <button class="btn btn-primary" onclick="openSection('admin')" style="width:auto;">Admin</button>
        <button class="btn btn-primary" onclick="openSection('marksUpload')" style="width:auto;">Upload Marks</button>
      </div>
       
      <div style="margin-top:20px; padding:15px; background:#f0f9ff; border-radius:10px;">
        <h3 style="color:#4f05fd; text-align:center;">Important Note</h3>
        
        <h4>English Version:</h4>
        <p style="text-align:justify; color:#555;">
          When a student fills out the form and submits it, they will receive their roll number. 
          After receiving the roll number, they will be able to check their marks slip. 
          The slip will appear on the portal after the form payment is completed and approved by the admin. 
          Admin approval will be completed within 24 hours.
        </p>

        <h4>Sindhi Version:</h4>
        <p style="text-align:justify; color:#555; direction:rtl;">
          ÿ¨⁄èŸáŸÜ ÿ¥ÿß⁄Øÿ±ÿØ ŸÅÿßÿ±ŸÖ ⁄Äÿ±Ÿä ⁄™ÿ±Ÿä ÿ≥ÿ®ŸÖŸΩ ⁄™ŸÜÿØŸàÿå ÿ™⁄èŸáŸÜ ⁄©Ÿäÿ≥ ŸæŸÜŸáŸÜÿ¨Ÿà ÿ±ŸàŸÑ ŸÜŸÖÿ®ÿ± ŸÖŸÑŸä ŸàŸäŸÜÿØŸà. 
          ÿ±ŸàŸÑ ŸÜŸÖÿ®ÿ± ŸÖŸÑ⁄ª ⁄©ÿßŸÜ ŸæŸàÿ°Ÿêÿå ŸáŸà ŸæŸÜŸáŸÜÿ¨Ÿä ŸÖÿßÿ±⁄™ÿ≥ ÿ≥ŸÑŸæ ⁄ÜŸä⁄™ ⁄™ÿ±Ÿä ÿ≥⁄ØŸáŸÜÿØŸà. 
          ŸÅÿßÿ±ŸÖ ÿ¨Ÿä ÿßÿØÿßÿ¶Ÿä⁄ØŸä €Ω ÿßŸä⁄äŸÖŸÜ ÿ¨Ÿä ŸÖŸÜÿ∏Ÿàÿ±Ÿä ŸøŸä⁄ª ⁄©ÿßŸÜ ŸæŸàÿ°Ÿê ÿ≥ŸÑŸæ ŸæŸàÿ±ŸπŸÑ ÿ™Ÿä ÿ∏ÿßŸáÿ± ŸøŸä ŸàŸäŸÜÿØŸä. 
          ÿßŸä⁄äŸÖŸÜ ÿ¨Ÿä ŸÖŸÜÿ∏Ÿàÿ±Ÿä 24 ⁄™ŸÑÿß⁄™ŸÜ ÿßŸÜÿØÿ± ŸøŸä ŸàŸäŸÜÿØŸä.
        </p>
      </div>

      <div style="display:flex;justify-content:center;gap:8px;margin-top:8px; flex-wrap:wrap;">
        <img src="AD02.jpeg" width="340" height="560" alt="" style="border-radius:10px; margin:5px;">
        <img src="AD 1.jpeg" width="340" height="560" alt="" style="border-radius:10px; margin:5px;">
      </div>

      <div style="display:flex;flex-wrap:wrap;justify-content:center;margin-top:12px; gap:15px;">
        <div class="small-card">
          <div class="card-header">Director</div>
          <img src="p.jpg" alt="" style="width:120px;height:120px;border-radius:50%;margin-top:12px" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"120\" height=\"120\"><rect width=\"120\" height=\"120\" fill=\"%23f0f0f0\"/><text x=\"60\" y=\"60\" font-family=\"Arial\" font-size=\"14\" fill=\"%23999\" text-anchor=\"middle\" dy=\".3em\">No Image</text></svg>'">
          <div class="name">Noor Muhammad Musafir Soomro</div>
          <div style="margin:8px 0"><a class="call-btn" href="tel:03083442741">üìû Call</a></div>
        </div>
        <div class="small-card">
          <div class="card-header">Pattern</div>
          <img src="Sir gada hussain.jpg" alt="" style="width:120px;height:120px;border-radius:50%;margin-top:12px" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"120\" height=\"120\"><rect width=\"120\" height=\"120\" fill=\"%23f0f0f0\"/><text x=\"60\" y=\"60\" font-family=\"Arial\" font-size=\"14\" fill=\"%23999\" text-anchor=\"middle\" dy=\".3em\">No Image</text></svg>'">
          <div class="name">Gada Hussain Soomro</div>
          <div style="margin:8px 0"><a class="call-btn" href="tel:03083442741">üìû Call</a> <a class="wa-btn" href="https://wa.me/923083442741">WhatsApp</a></div>
        </div>
        <div class="small-card">
          <div class="card-header">Teacher</div>
          <img src="sir Ahmed.jpg" alt="" style="width:120px;height:120px;border-radius:50%;margin-top:12px" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"120\" height=\"120\"><rect width=\"120\" height=\"120\" fill=\"%23f0f0f0\"/><text x=\"60\" y=\"60\" font-family=\"Arial\" font-size=\"14\" fill=\"%23999\" text-anchor=\"middle\" dy=\".3em\">No Image</text></svg>'">
          <div class="name">Ahmed Ali Chachar</div>
          <div style="margin:8px 0"><a class="call-btn" href="tel:03002627384">üìû Call</a> <a class="wa-btn" href="https://wa.me/923002627384">WhatsApp</a></div>
        </div>
        
        <div class="small-card">
          <div class="card-header">Web Dev</div>
          <img src="ubedulla khan.PNG" alt="" style="width:120px;height:120px;border-radius:50%;margin-top:12px" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"120\" height=\"120\"><rect width=\"120\" height=\"120\" fill=\"%23f0f0f0\"/><text x=\"60\" y=\"60\" font-family=\"Arial\" font-size=\"14\" fill=\"%23999\" text-anchor=\"middle\" dy=\".3em\">No Image</text></svg>'">
          <div class="name">Ubedullah Khan</div>
          <div style="margin:8px 0"><a class="call-btn" href="tel:03013402708">üìû Call</a> <a class="wa-btn" href="https://wa.me/923013402708">WhatsApp</a></div>
        </div>
      </div>
     
      <div class="footer-links" style="margin-top:30px;">
        <a href="https://www.facebook.com/groups/600983602483223/?ref=share&mibextid=NSMWBT" target="_blank" rel="noopener noreferrer">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8.9v-3h1.6V9.1c0-1.6.95-2.5 2.4-2.5.7 0 1.4.05 2 .1v2.3h-1.2c-1 0-1.3.6-1.3 1.2V12h2.3l-.37 3h-1.95v7A10 10 0 0 0 22 12z"/>
          </svg>
          Facebook Group
        </a>

        <a href="https://chat.whatsapp.com/GzjZLkgNvS8LQpIpqm1li5?mode=hqrt1" target="_blank" rel="noopener noreferrer">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M20.5 3.5A11.8 11.8 0 0 0 3.5 20.5L3 22l1.6-.42A11.8 11.8 0 0 0 20.5 3.5zM12 20a8 8 0 1 1 0-16 8 8 0 0 1 0 16zM17.2 14.2c-.3-.15-1.7-.85-2-.95-.3-.1-.5-.15-.7.15-.2.3-.8.95-.95 1.15-.15.2-.3.2-.6.07-.3-.13-1.25-.45-2.4-1.48-.9-.8-1.5-1.78-1.68-2.08-.17-.3 0-.46.13-.6.13-.13.3-.35.45-.53.15-.18.2-.3.3-.5.1-.2 0-.4-.05-.55-.05-.15-.7-1.68-.96-2.3-.25-.6-.5-.5-.7-.5h-.6c-.2 0-.5.07-.78.34-.27.27-1.04 1.02-1.04 2.48 0 1.45 1.06 2.85 1.2 3.05.13.2 2.07 3.18 5 4.45 2.9 1.27 2.9 0 3.24-.03.34-.03 1.42-.57 1.62-1.12.2-.55.2-1.02.14-1.12-.06-.1-.27-.15-.57-.3z"/>
          </svg>
          WhatsApp Group 
        </a>
      </div>

      <div class="social-bar" aria-hidden="false" aria-label="Social links">
        <a
          class="social-btn facebook"
          href="https://www.facebook.com/groups/600983602483223/?ref=share&mibextid=NSMWBT"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Facebook Group"
        >
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
            <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8.9v-3h1.6V9.1c0-1.6.95-2.5 2.4-2.5.7 0 1.4.05 2 .1v2.3h-1.2c-1 0-1.3.6-1.3 1.2V12h2.3l-.37 3h-1.95v7A10 10 0 0 0 22 12z"/>
          </svg>
          <span class="tooltip" role="tooltip">Facebook Group</span>
        </a>

        <a
          class="social-btn whatsapp"
          href="https://chat.whatsapp.com/GzjZLkgNvS8LQpIpqm1li5?mode=hqrt1"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="WhatsApp Group"
        >
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
            <path d="M20.5 3.5A11.8 11.8 0 0 0 3.5 20.5L3 22l1.6-.42A11.8 11.8 0 0 0 20.5 3.5zM12 20a8 8 0 1 1 0-16 8 8 0 0 1 0 16zM17.2 14.2c-.3-.15-1.7-.85-2-.95-.3-.1-.5-.15-.7.15-.2.3-.8.95-.95 1.15-.15.2-.3.2-.6.07-.3-.13-1.25-.45-2.4-1.48-.9-.8-1.5-1.78-1.68-2.08-.17-.3 0-.46.13-.6.13-.13.3-.35.45-.53.15-.18.2-.3.3-.5.1-.2 0-.4-.05-.55-.05-.15-.7-1.68-.96-2.3-.25-.6-.5-.5-.7-.5h-.6c-.2 0-.5.07-.78.34-.27.27-1.04 1.02-1.04 2.48 0 1.45 1.06 2.85 1.2 3.05.13.2 2.07 3.18 5 4.45 2.9 1.27 2.9 0 3.24-.03.34-.03 1.42-.57 1.62-1.12.2-.55.2-1.02.14-1.12-.06-.1-.27-.15-.57-.3z"/>
          </svg>
          <span class="tooltip" role="tooltip">WhatsApp Group</span>
        </a>
      </div>

      <div class="teacher-gallery" aria-hidden="false">
        <img src="sir gada.PNG" alt="Sir Gada" onerror="this.style.display='none'">
        <img src="p6.jpg" alt="Ahmed" onerror="this.style.display='none'">
        <img src="p2.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p13.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p15.jpg" alt="Sir Niaz" onerror="this.style.display='none'">
        <img src="p14.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p5.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p4.jpg" alt="Sir Niaz" onerror="this.style.display='none'">
        <img src="p7.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p8.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p12.jpg" alt="Ubedullah Khan" onerror="this.style.display='none'">
        <img src="p10.jpg" alt="Sir Niaz" onerror="this.style.display='none'">
        <img src="p11.jpg" alt="Sir Niaz" onerror="this.style.display='none'">
      </div>
    </section>

    <!-- Apply Section -->
    <section id="apply" class="card hidden">
      <div style="padding:6px;background:#f5f7f8;border-radius:10px;text-align:center">
        <h3>Dua Educational Academy Kamoon Shaheed</h3>
        <h2>Online Apply Form</h2>

        <form id="applyForm" autocomplete="off">
          <h4 class="small" style="color:var(--accent)">Student Information</h4>
          <label> Name <input id="stu_name" required /></label>
          <label> Surname <input id="stu_surname" required /></label>

          <label> Gender
            <select id="stu_gender" required>
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </label>

          <label> Date of Birth <input id="stu_dob" type="date" required /></label>
          <label> CNIC (13 digits) <input id="stu_cnic" maxlength="13" inputmode="numeric" pattern="[0-9]*" required /></label>

          <label> Class
            <select id="stu_class" required onchange="calcAppFee()">
              <option value="">Select Class</option>
              <option value="5">5</option><option value="6">6</option><option value="7">7</option>
              <option value="8">8</option><option value="9">9</option><option value="10">10</option>
              <option value="11-Medical">11 - Medical</option><option value="11-Eng">11 - Eng</option>
              <option value="12-Medical">12 - Medical</option><option value="12-Eng">12 - Eng</option>
            </select>
          </label>

          <label> Past School Name <input id="stu_pastSchool" /></label>
          <label> WhatsApp Number (11 digits) <input id="stu_whatsapp" maxlength="11" inputmode="numeric" pattern="[0-9]*" /></label>
          <label> Upload Photo (optional) <input id="stu_photo" type="file" accept="image/*" /></label>

          <h4 class="small" style="color:var(--accent)">Father Information</h4>
          <label> Father Name <input id="father_name" required /></label>
          <label> Father Surname <input id="father_surname" required /></label>
          <label> Father CNIC (13 digits) <input id="father_cnic" maxlength="13" inputmode="numeric" pattern="[0-9]*" required /></label>
          <label> Occupation <input id="father_occupation" /></label>

          <h4 class="small" style="color:var(--accent)">Payment</h4>
          <label> Application Fee  <input id="app_fee" readonly /> </label>
          <label class="small">Click <strong>Proceed to Payment</strong> to open payment form and submit payment details (amount is fixed to 650).</label>

          <div class="btn-row">
            <button class="btn btn-primary" id="proceedPaymentBtn" type="button">Proceed to Payment</button>
            <button type="button" class="btn btn-ghost" onclick="applyFormReset()">Reset</button>
          </div>
        </form>

        <div id="applyConfirm" class="hidden" style="margin-top:14px"></div>

        <h4 style="margin-top:14px">Saved Applications</h4>
        <div id="appsList" class="small">No applications yet.</div>
      </div>
    </section>

    <!-- Slip Section -->
    <section id="slip" class="card hidden">
      <div style="padding:12px;background:#f0f9ff;border-radius:10px;text-align:center">
        <img src="logo dua Academy kamoon shaheed.PNG" class="stu-photo" alt="Logo" onerror="this.style.display='none'">
        <h2>Admit Slip</h2>
        <label> Enter Roll Number <input id="slip_roll" /></label>
        <div style="display:flex;gap:8px">
          <button class="btn btn-primary" id="genSlipBtn">Generate Slip</button>
          <button class="btn btn-ghost" id="printSlipBtn">Print / Save PDF</button>
        </div>
        <div id="slipArea" style="margin-top:12px"></div>
      </div>
    </section>

    <!-- Result Section -->
    <section id="result" class="card hidden">
      <div style="padding:8px;background:#f6f7f8;border-radius:6px;text-align:center">
        <img src="logo dua Academy kamoon shaheed.PNG" width="200" height="180" alt="Logo" onerror="this.style.display='none'">
        <h2>Result</h2>
        <label> Enter Roll Number <input id="res_roll" /></label>
        <div style="display:flex;gap:8px">
          <button class="btn btn-primary" id="checkResBtn">Check Result</button>
          <button class="btn btn-ghost" id="printResultBtn">Print / Save PDF</button>
        </div>
        <div id="resultArea" style="margin-top:12px"></div>
      </div>
    </section>

    <!-- Admin Section -->
    <section id="admin" class="card hidden">
      <div style="padding:12px;background:#f0f9ff;border-radius:10px;text-align:center">
        <img src="logo dua Academy kamoon shaheed.PNG" width="200" height="200" alt="Logo" onerror="this.style.display='none'">
        <h2>Admin Panel</h2>

        <form id="adminLoginForm">
          <label> Password <input id="adminPass" type="password" required /></label>
          <div style="display:flex;gap:8px"><button class="btn btn-primary" type="submit">Login</button></div>
        </form>

        <div id="adminArea" class="hidden" style="margin-top:12px">
          <h4>Applications & Marks (editable)</h4>
          <table class="table" id="adminTable">
            <thead>
              <tr>
                <th>Roll</th><th>Photo</th><th>Name</th><th>Surname</th><th>Gender</th><th>DOB</th><th>CNIC</th>
                <th>Class</th><th>Past School</th><th>WhatsApp</th><th>Father Name</th><th>Father Surname</th>
                <th>Father CNIC</th><th>Father Occupation</th><th>Fee</th><th>Payment From</th><th>Payment</th><th>Marks</th><th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Marks Upload Section -->
    <section id="marksUpload" class="card hidden">
      <div style="padding:12px;background:#f0f9ff;border-radius:10px;text-align:center">
        <img src="logo dua Academy kamoon shaheed.PNG" width="200" height="200" alt="Logo" onerror="this.style.display='none'">
        <h2>Upload Marks (Single entry test)</h2>
        <form id="marksForm">
          <label>Password <input id="marksPass" type="password" required /></label>
          <div style="display:flex;gap:8px"><button class="btn btn-primary" type="submit">Open</button></div>
        </form>

        <div id="marksArea" class="hidden" style="margin-top:12px">
          <label> Roll Number <input id="marks_roll" /></label>
          <label> Marks (0-100) <input id="marks_value" type="number" min="0" max="100" /></label>
          <div style="display:flex;gap:8px"><button id="saveMarksBtn" class="btn btn-primary">Upload Marks</button>
          <button class="btn btn-ghost" onclick="openSection('admin')">Go to Admin</button></div>
        </div>
      </div>
    </section>
  </main>

  <footer style="text-align:center;margin-top:18px" class="small">
    ¬© Dua Educational Academy Kamoon Shaheed Portal ‚Ä¢ All Rights Reserved
  </footer>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal-backdrop" aria-hidden="true" style="display:none;">
  <div class="modal" role="dialog" aria-modal="true">
    <h3>Payment Details</h3>
    <p class="note">Amount is fixed to <strong>650</strong>. Fill the payment details and upload transaction screenshot. Admin will verify and approve.</p>
    <h5>Jazzcash: 03083842741 (GADA HUSSAIN)</h5>
    <form id="paymentForm">
      <div style="display:flex;gap:10px;margin-bottom:10px;">
        <div style="flex:1;">
          <label>Student Name <input id="pay_student_name" required /></label>
        </div>
        <div style="flex:1;">
          <label>Amount <input id="pay_amount" readonly /></label>
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-bottom:10px;">
        <div style="flex:1;">
          <label>Payment From (Mobile Number) 
            <input id="pay_from_number" maxlength="11" inputmode="numeric" 
                   placeholder="03XXXXXXXXX" required />
          </label>
        </div>
        <div style="flex:1;">
          <label>Transaction ID / Ref <input id="pay_txn" required /></label>
        </div>
      </div>

      <label>
        Upload Transaction Screenshot (required) 
        <input id="pay_screenshot" type="file" accept="image/*" required />
        <div class="small">Max size: 10MB ‚Ä¢ Formats: JPG, PNG</div>
      </label>
      
      <div id="previewContainer" style="margin-top: 10px;">
        <img id="pay_preview" class="hidden" 
             alt="Screenshot preview" style="max-width:100%; max-height:150px; border-radius:5px;" />
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button type="button" id="cancelPay" class="btn btn-ghost">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit Payment & Save Application</button>
      </div>
    </form>
  </div>
</div>

<script>
/* ------------------ CONFIG ------------------ */
const ADMIN_PASSWORD = 'uk6091';
const ACADEMY_NAME = 'Dua Educational Academy Kamoon Shaheed';
const FIXED_AMOUNT = 650;

/* ------------------ HELPERS ------------------ */
function q(id){ return document.getElementById(id); }

function readApps(){ 
  try{ 
    const data = localStorage.getItem('apps');
    if(!data) return [];
    const parsed = JSON.parse(data);
    return Array.isArray(parsed) ? parsed : [];
  } catch(e){ 
    console.error('Error reading apps:', e);
    return []; 
  }
}

function readMarks(){ 
  try{ 
    const data = localStorage.getItem('marks');
    if(!data) return [];
    const parsed = JSON.parse(data);
    return Array.isArray(parsed) ? parsed : [];
  } catch(e){ 
    console.error('Error reading marks:', e);
    return []; 
  }
}

function saveApps(arr){
  try{
    localStorage.setItem('apps', JSON.stringify(arr));
    // Backup in sessionStorage
    sessionStorage.setItem('apps_backup', JSON.stringify(arr));
    console.log('Apps saved successfully. Total:', arr.length);
    return true;
  } catch(e){
    console.error('Error saving apps:', e);
    alert('Storage error: ' + e.message);
    return false;
  }
}

function saveMarks(arr){
  try{
    localStorage.setItem('marks', JSON.stringify(arr));
    return true;
  } catch(e){
    console.error('Error saving marks:', e);
    return false;
  }
}

function showToast(msg, time=3500){ 
  const t = q('toast'); 
  t.textContent = msg; 
  t.style.display = 'block'; 
  setTimeout(() => t.style.display = 'none', time); 
}

function escapeHtml(s){ 
  if(!s) return '';
  return s.toString()
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}

/* ------------------ UI control ------------------ */
const sections = ['home','apply','slip','result','admin','marksUpload'];
function openSection(id){
  sections.forEach(s => {
    q(s).classList.toggle('hidden', s !== id);
  });
  window.scrollTo({top:0,behavior:'smooth'});
}
window.openSection = openSection;
openSection('home');

/* ------------------ Roll generator ------------------ */
function getNextRoll(){
  let r = Number(localStorage.getItem('next_roll') || 801);
  const current = String(r);
  localStorage.setItem('next_roll', String(r+1));
  return current;
}

/* ------------------ Fees ------------------ */
function calcAppFee(){
  q('app_fee').value = FIXED_AMOUNT;
}
window.calcAppFee = calcAppFee;
calcAppFee();

/* ------------------ Render apps list ------------------ */
function renderAppsList(){
  const apps = readApps();
  const el = q('appsList');
  
  if(!apps || apps.length === 0){ 
    el.innerHTML = '<div style="text-align:center;padding:20px;color:#666;background:#f8fafc;border-radius:8px;">No applications yet. Submit your first application!</div>'; 
    return; 
  }
  
  let html = '<h4 style="margin-bottom:10px;color:var(--accent);">Recent Applications</h4>';
  
  // Show latest applications first
  apps.slice().reverse().forEach(a => {
    html += `
      <div class="result-row">
        <div style="display:flex;gap:10px;align-items:center">
          <img src="${a.photo||a.feeImage||''}" 
               onerror="this.style.display='none'" 
               style="width:48px;height:48px;border-radius:6px;object-fit:cover"/>
          <div>
            <strong>${escapeHtml(a.name)} ${escapeHtml(a.surname)}</strong>
            <div class="small">Roll: ${a.roll} ‚Ä¢ Class: ${escapeHtml(a.class)}</div>
            <div class="small">Fee: ${a.appFee} ‚Ä¢ Status: 
              <span style="color:${a.paymentStatus === 'Approved' ? 'green' : a.paymentStatus === 'Rejected' ? 'red' : 'orange'}">
                ${a.paymentStatus}
              </span>
            </div>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button class="btn btn-ghost" onclick="quickView('${a.roll}')">View Slip</button>
        </div>
      </div>`;
  });
  
  el.innerHTML = html;
}

function quickView(roll){
  q('slip_roll').value = roll;
  openSection('slip');
  genSlip();
}

/* ------------------ APPLY FORM FLOW ------------------ */
const applyForm = q('applyForm');
const applyConfirm = q('applyConfirm');

// Reset form
function applyFormReset(){
  applyForm.reset();
  calcAppFee();
  applyConfirm.classList.add('hidden');
  applyConfirm.innerHTML = '';
  applyForm.classList.remove('hidden');
  showToast('Form reset successfully');
}
window.applyFormReset = applyFormReset;

// When user clicks Proceed to Payment
q('proceedPaymentBtn').addEventListener('click', function(){
  // Basic validations
  const name = q('stu_name').value.trim();
  const surname = q('stu_surname').value.trim();
  const cnic = q('stu_cnic').value.trim();
  const stuClass = q('stu_class').value;
  const fatherCnic = q('father_cnic').value.trim();
  const whatsapp = q('stu_whatsapp').value.trim();
  
  if(!name || !surname){ 
    alert('Please enter student name and surname'); 
    return; 
  }
  
  if(!stuClass){ 
    alert('Please select class'); 
    return; 
  }
  
  if(cnic && cnic.length !== 13){ 
    alert('Student CNIC must be 13 digits'); 
    return; 
  }
  
  if(fatherCnic && fatherCnic.length !== 13){ 
    alert('Father CNIC must be 13 digits'); 
    return; 
  }
  
  if(whatsapp && whatsapp.length !== 11){ 
    alert('WhatsApp number must be 11 digits'); 
    return; 
  }
  
  // Prepare snapshot
  const snapshot = {
    roll: getNextRoll(),
    name: name,
    surname: surname,
    gender: q('stu_gender').value,
    dob: q('stu_dob').value,
    cnic: cnic,
    class: stuClass,
    pastSchool: q('stu_pastSchool').value.trim(),
    whatsapp: whatsapp,
    photoFile: q('stu_photo').files && q('stu_photo').files[0] ? q('stu_photo').files[0] : null,
    appFee: FIXED_AMOUNT,
    fatherName: q('father_name').value.trim(),
    fatherSurname: q('father_surname').value.trim(),
    fatherCnic: fatherCnic,
    fatherOccupation: q('father_occupation').value.trim()
  };
  
  openPaymentModal(snapshot);
});

/* ------------------ PAYMENT MODAL ------------------ */
const paymentModal = q('paymentModal');
const paymentForm = q('paymentForm');
let currentSnapshot = null;

function openPaymentModal(snapshot){
  currentSnapshot = snapshot;
  q('pay_student_name').value = snapshot.name || '';
  q('pay_amount').value = FIXED_AMOUNT;
  q('pay_from_number').value = '';
  q('pay_txn').value = '';
  q('pay_screenshot').value = '';
  
  const preview = q('pay_preview');
  preview.src = '';
  preview.classList.add('hidden');
  
  paymentModal.style.display = 'flex';
  paymentModal.setAttribute('aria-hidden','false');
}

q('cancelPay').addEventListener('click', () => {
  paymentModal.style.display = 'none';
  paymentModal.setAttribute('aria-hidden','true');
  currentSnapshot = null;
});

// Preview screenshot
q('pay_screenshot').addEventListener('change', function(){
  const file = this.files && this.files[0];
  const img = q('pay_preview');
  
  if(!file){ 
    img.src = ''; 
    img.classList.add('hidden'); 
    return; 
  }
  
  if(file.size > 10 * 1024 * 1024){
    alert('File size should be less than 10MB');
    this.value = '';
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(){
    img.src = reader.result;
    img.classList.remove('hidden');
  };
  reader.onerror = function(){
    alert('Error reading file');
    this.value = '';
  };
  reader.readAsDataURL(file);
});

// Payment form submit
paymentForm.addEventListener('submit', function(e){
  e.preventDefault();
  
  if(!currentSnapshot){ 
    alert('No application data found. Please refill the form.'); 
    paymentModal.style.display = 'none'; 
    return; 
  }

  const fromNum = q('pay_from_number').value.trim();
  const txn = q('pay_txn').value.trim();
  const feeFile = q('pay_screenshot').files && q('pay_screenshot').files[0];
  
  if(!/^03[0-9]{9}$/.test(fromNum)){ 
    alert('Payment number must be in 03XXXXXXXXX format'); 
    return; 
  }
  
  if(!txn){ 
    alert('Enter transaction ID / reference'); 
    return; 
  }
  
  if(!feeFile){ 
    alert('Upload transaction screenshot'); 
    return; 
  }

  currentSnapshot.paymentSenderNumber = fromNum;
  currentSnapshot.txnId = txn;
  currentSnapshot.feeFile = feeFile;

  readFilesAndSave(currentSnapshot, { approved: false });
});

/* Read files and save application */
function readFilesAndSave(snapshot, opts){
  const feeFile = snapshot.feeFile;
  const photoFile = snapshot.photoFile;

  const readFee = (callback) => {
    if(!feeFile){ 
      callback(''); 
      return; 
    }
    
    const reader = new FileReader();
    reader.onload = function(){ 
      callback(reader.result); 
    };
    reader.onerror = function(){ 
      console.error('Error reading fee file');
      callback(''); 
    };
    reader.readAsDataURL(feeFile);
  };

  const readPhoto = (callback) => {
    if(!photoFile){ 
      callback(''); 
      return; 
    }
    
    const reader = new FileReader();
    reader.onload = function(){ 
      callback(reader.result); 
    };
    reader.onerror = function(){ 
      console.error('Error reading photo file');
      callback(''); 
    };
    reader.readAsDataURL(photoFile);
  };

  readFee(function(feeData){
    readPhoto(function(photoData){
      saveApplication(snapshot, feeData, photoData, opts);
    });
  });
}

/* FIXED: Save Application Function */
function saveApplication(snapshot, feeData, photoData, opts){
  try {
    const app = {
      roll: snapshot.roll,
      name: snapshot.name,
      surname: snapshot.surname,
      gender: snapshot.gender,
      dob: snapshot.dob,
      cnic: snapshot.cnic,
      class: snapshot.class,
      pastSchool: snapshot.pastSchool,
      whatsapp: snapshot.whatsapp,
      photo: photoData || '',
      feeImage: feeData || '',
      paymentStatus: opts.approved ? 'Approved' : 'Pending',
      appFee: snapshot.appFee,
      paymentSenderNumber: snapshot.paymentSenderNumber || '',
      fatherName: snapshot.fatherName,
      fatherSurname: snapshot.fatherSurname,
      fatherCnic: snapshot.fatherCnic,
      fatherOccupation: snapshot.fatherOccupation,
      txId: snapshot.txnId || '',
      createdAt: new Date().toISOString()
    };

    let apps = readApps();
    apps.push(app);
    
    if(saveApps(apps)){
      // Show confirmation
      applyConfirm.classList.remove('hidden');
      applyConfirm.innerHTML = `
        <div class="confirm-box">
          <img src="${photoData || feeData || ''}" class="stu-photo" onerror="this.style.display='none'"/>
          <div>
            <div style="font-weight:800;color:#0f172a;font-size:18px;">‚úÖ Application Submitted Successfully!</div>
            <div style="margin-top:8px"><strong>Roll Number:</strong> <span style="color:var(--accent);font-size:20px;">${app.roll}</span></div>
            <div><strong>${escapeHtml(app.name)} ${escapeHtml(app.surname)}</strong> ‚Ä¢ ${escapeHtml(app.gender)}</div>
            <div class="small">Class: ${escapeHtml(app.class)} ‚Ä¢ DOB: ${escapeHtml(app.dob)}</div>
            <div class="small">Fee: ${app.appFee} ‚Ä¢ Status: <span style="color:orange">${app.paymentStatus}</span></div>
            <div class="small">Payment From: <strong>${escapeHtml(app.paymentSenderNumber)}</strong></div>
            <div class="small" style="margin-top:8px;color:orange;background:#fff3cd;padding:8px;border-radius:5px;">
              ‚ö†Ô∏è Payment pending verification. Admin will verify within 24 hours.
            </div>
            <div style="margin-top:15px;display:flex;gap:8px;flex-wrap:wrap;">
              <button class="btn btn-primary" onclick="copyRoll('${app.roll}')">üìã Copy Roll</button>
              <button class="btn btn-ghost" onclick="openSection('slip'); q('slip_roll').value='${app.roll}'; genSlip()">üëÅÔ∏è View Slip</button>
              <button class="btn" onclick="applyFormReset()">‚ùå Close</button>
            </div>
          </div>
        </div>
      `;
      
      applyForm.reset();
      applyForm.classList.add('hidden');
      paymentModal.style.display = 'none';
      paymentModal.setAttribute('aria-hidden','true');
      currentSnapshot = null;
      
      renderAppsList();
      
      if(!q('adminArea').classList.contains('hidden')){
        loadAdminData();
      }
      
      showToast('‚úÖ Application saved successfully! Roll: ' + app.roll);
    } else {
      alert('Failed to save application. Please try again.');
    }
    
  } catch (error) {
    console.error('Error in saveApplication:', error);
    alert('Error: ' + error.message);
  }
}

function copyRoll(r){ 
  navigator.clipboard.writeText(r).then(() => {
    showToast('Roll number copied to clipboard: ' + r);
  }).catch(() => {
    prompt('Copy this roll number:', r);
  });
}

/* ------------------ Slip generation ------------------ */
q('genSlipBtn').addEventListener('click', genSlip);

function genSlip(){
  const roll = q('slip_roll').value.trim();
  if(!roll){ 
    alert('Enter roll number'); 
    return; 
  }

  const apps = readApps();
  const app = apps.find(x => x.roll === roll);

  if(!app){
    q('slipArea').innerHTML = '<div class="small" style="color:red;padding:20px;text-align:center;">Roll number not found</div>';
    return;
  }

  if(app.paymentStatus !== 'Approved'){
    q('slipArea').innerHTML = `
      <div style="color:red;font-size:16px;padding:20px;text-align:center;background:#ffe6e6;border-radius:10px;">
        <strong>‚ö†Ô∏è Payment Not Verified</strong><br>
        Status: ${escapeHtml(app.paymentStatus)}<br>
        Contact admin for verification.
      </div>`;
    return;
  }

  q('slipArea').innerHTML = `
    <div class="slip-wrapper">
      <div class="slip-header">
        <img src="logo dua Academy kamoon shaheed.PNG" class="academy-logo" onerror="this.style.display='none'">
        <div class="academy-title">Dua Educational Academy Kamoon Shaheed</div>
      </div>
      
      <div class="slip-box">
        <div class="left-photo">
          <img src="${app.photo || ''}" class="stu-photo" onerror="this.style.display='none'">
        </div>
        
        <div class="data">
          <div class="slip-heading">Student Admit Slip</div>
          
          <div class="field"><strong>Name:</strong> ${escapeHtml(app.name)} ${escapeHtml(app.surname)}</div>
          <div class="field"><strong>Gender:</strong> ${escapeHtml(app.gender)} | <strong>DOB:</strong> ${escapeHtml(app.dob)}</div>
          <div class="field"><strong>CNIC:</strong> ${escapeHtml(app.cnic)}</div>
          <div class="field"><strong>Class:</strong> ${escapeHtml(app.class)}</div>
          
          <div class="small-heading">Roll Number</div>
          <div class="roll-style">${escapeHtml(app.roll)}</div>
          
          <div class="field"><strong>Application Fee:</strong> Rs. ${app.appFee}</div>
          <div class="field"><strong>Payment Status:</strong> <span style="color:green">${escapeHtml(app.paymentStatus)}</span></div>
          <div class="field"><strong>Payment From:</strong> ${escapeHtml(app.paymentSenderNumber || 'N/A')}</div>
          <div class="field"><strong>WhatsApp:</strong> ${escapeHtml(app.whatsapp || 'N/A')}</div>
          <div class="field"><strong>Past School:</strong> ${escapeHtml(app.pastSchool || 'N/A')}</div>
          
          <div class="small-heading">Father Information</div>
          <div class="field"><strong>Name:</strong> ${escapeHtml(app.fatherName)} ${escapeHtml(app.fatherSurname)}</div>
          <div class="field"><strong>CNIC:</strong> ${escapeHtml(app.fatherCnic)}</div>
          <div class="field"><strong>Occupation:</strong> ${escapeHtml(app.fatherOccupation || 'N/A')}</div>
        </div>
      </div>
      
      <div class="sign-row">
        <div>
          <img src="director_sign.png" class="sign-img" onerror="this.style.display='none'">
          <div class="sign-text">Director Signature</div>
        </div>
        <div>
          <img src="stamp.png" class="stamp-img" onerror="this.style.display='none'">
          <div class="sign-text">Official Stamp</div>
        </div>
      </div>
    </div>`;
}

/* ------------------ PRINT SLIP ------------------ */
q('printSlipBtn').addEventListener('click', () => {
  if(!q('slipArea').innerHTML){ 
    alert('No slip to print'); 
    return; 
  }

  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <html>
      <head>
        <title>Admit Slip - ${ACADEMY_NAME}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
          .slip-wrapper { border: 3px solid #0077ff; padding: 25px; border-radius: 12px; }
          .academy-title { font-size: 24px; font-weight: bold; color: #00306e; text-align: center; margin-bottom: 20px; }
          .slip-box { display: flex; gap: 20px; margin: 20px 0; }
          .stu-photo { width: 140px; height: 160px; object-fit: cover; border: 2px solid #00306e; border-radius: 10px; }
          .roll-style { font-size: 18px; padding: 5px 15px; color: white; background: #0077ff; border-radius: 8px; display: inline-block; font-weight: bold; }
          .sign-row { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; }
          @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
        </style>
      </head>
      <body>
        ${q('slipArea').innerHTML}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.focus();
  setTimeout(() => {
    printWindow.print();
    printWindow.close();
  }, 500);
});

/* ------------------ RESULTS ------------------ */
q('checkResBtn').addEventListener('click', function(){
  const roll = q('res_roll').value.trim();
  
  if(!roll){ 
    alert('Enter roll number'); 
    return; 
  }

  const apps = readApps();
  const app = apps.find(x => x.roll === roll);

  if(!app){
    q('resultArea').innerHTML = '<div class="small" style="color:red;padding:20px;text-align:center;">Roll number not found</div>';
    return;
  }

  const marks = readMarks().filter(m => m.rollNumber === roll).map(m => m.marks);
  const avgMark = marks.length ? (marks.reduce((a, b) => a + Number(b), 0) / marks.length).toFixed(2) : 0;
  const grade = marks.length ? calculateGrade(avgMark) : 'N/A';

  q('resultArea').innerHTML = `
    <div class="slip-wrapper">
      <div class="slip-header">
        <img src="logo dua Academy kamoon shaheed.PNG" class="academy-logo" onerror="this.style.display='none'">
        <div class="academy-title">Dua Educational Academy Kamoon Shaheed</div>
      </div>
      
      <div class="slip-box">
        <div class="left-photo">
          <img src="${app.photo || ''}" class="stu-photo" onerror="this.style.display='none'">
        </div>
        
        <div class="data">
          <div class="slip-heading">Result Card</div>
          
          <div class="field"><strong>Name:</strong> ${escapeHtml(app.name)} ${escapeHtml(app.surname)}</div>
          <div class="field"><strong>Class:</strong> ${escapeHtml(app.class)}</div>
          <div class="field"><strong>Roll Number:</strong> <span class="roll-style">${escapeHtml(app.roll)}</span></div>
          
          <div class="small-heading">Marks Details</div>
          <div class="field"><strong>Marks:</strong> ${marks.length ? marks.join(', ') : 'Not uploaded yet'}</div>
          <div class="field"><strong>Average:</strong> ${avgMark}</div>
          <div class="field"><strong>Grade:</strong> <span style="font-size:18px;color:${grade === 'Fail' ? 'red' : 'green'}">${grade}</span></div>
          
          <div class="field"><strong>Father:</strong> ${escapeHtml(app.fatherName)} ${escapeHtml(app.fatherSurname)}</div>
          <div class="field"><strong>CNIC:</strong> ${escapeHtml(app.fatherCnic)}</div>
        </div>
      </div>
      
      <div class="sign-row">
        <div>
          <img src="director_sign.png" class="sign-img" onerror="this.style.display='none'">
          <div class="sign-text">Director Signature</div>
        </div>
        <div>
          <img src="stamp.png" class="stamp-img" onerror="this.style.display='none'">
          <div class="sign-text">Official Stamp</div>
        </div>
      </div>
    </div>`;
});

function calculateGrade(mark){
  mark = Number(mark);
  if(mark >= 95) return 'A+';
  if(mark >= 85) return 'A';
  if(mark >= 75) return 'B+';
  if(mark >= 65) return 'B';
  if(mark >= 55) return 'C';
  if(mark >= 50) return 'D';
  return 'Fail';
}

q('printResultBtn').addEventListener('click', () => {
  if(!q('resultArea').innerHTML){ 
    alert('No result to print'); 
    return; 
  }
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <html>
      <head>
        <title>Result Card - ${ACADEMY_NAME}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
          .slip-wrapper { border: 3px solid #28a745; padding: 25px; border-radius: 12px; }
          .academy-title { font-size: 24px; font-weight: bold; color: #00306e; text-align: center; margin-bottom: 20px; }
          .slip-box { display: flex; gap: 20px; margin: 20px 0; }
          .stu-photo { width: 140px; height: 160px; object-fit: cover; border: 2px solid #28a745; border-radius: 10px; }
          .roll-style { font-size: 18px; padding: 5px 15px; color: white; background: #28a745; border-radius: 8px; display: inline-block; font-weight: bold; }
          .sign-row { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; }
          @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
        </style>
      </head>
      <body>
        ${q('resultArea').innerHTML}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.focus();
  setTimeout(() => {
    printWindow.print();
    printWindow.close();
  }, 500);
});

/* ------------------ ADMIN PANEL ------------------ */
q('adminLoginForm').addEventListener('submit', function(e){
  e.preventDefault();
  const pass = q('adminPass').value;
  if(pass === ADMIN_PASSWORD){
    q('adminLoginForm').classList.add('hidden');
    q('adminArea').classList.remove('hidden');
    loadAdminData();
    showToast('Admin login successful');
  } else {
    alert('Wrong password!');
  }
});

function loadAdminData(){
  const apps = readApps();
  const marks = readMarks();
  const tbody = document.querySelector('#adminTable tbody');
  
  tbody.innerHTML = '';
  
  apps.forEach(app => {
    const appMarks = marks.filter(m => m.rollNumber === app.roll).map(m => m.marks).join(', ');
    
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${escapeHtml(app.roll)}</td>
      <td><img src="${app.photo || ''}" class="admin-img" onerror="this.style.display='none'"></td>
      <td contenteditable="true" data-field="name">${escapeHtml(app.name)}</td>
      <td contenteditable="true" data-field="surname">${escapeHtml(app.surname)}</td>
      <td contenteditable="true" data-field="gender">${escapeHtml(app.gender)}</td>
      <td contenteditable="true" data-field="dob">${escapeHtml(app.dob)}</td>
      <td contenteditable="true" data-field="cnic">${escapeHtml(app.cnic)}</td>
      <td contenteditable="true" data-field="class">${escapeHtml(app.class)}</td>
      <td contenteditable="true" data-field="pastSchool">${escapeHtml(app.pastSchool)}</td>
      <td contenteditable="true" data-field="whatsapp">${escapeHtml(app.whatsapp)}</td>
      <td contenteditable="true" data-field="fatherName">${escapeHtml(app.fatherName)}</td>
      <td contenteditable="true" data-field="fatherSurname">${escapeHtml(app.fatherSurname)}</td>
      <td contenteditable="true" data-field="fatherCnic">${escapeHtml(app.fatherCnic)}</td>
      <td contenteditable="true" data-field="fatherOccupation">${escapeHtml(app.fatherOccupation)}</td>
      <td>${escapeHtml(app.appFee || '')}</td>
      <td>${escapeHtml(app.paymentSenderNumber || '')}</td>
      <td>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-start">
          <img src="${app.feeImage || ''}" style="width:70px;height:70px;border-radius:6px;object-fit:cover" onerror="this.style.display='none'"/>
          <div><strong>${escapeHtml(app.paymentStatus)}</strong></div>
          <div style="display:flex;gap:6px">
            <button class="btn btn-primary btn-approve">Approve</button>
            <button class="btn btn-ghost btn-reject">Reject</button>
          </div>
        </div>
      </td>
      <td contenteditable="true" data-field="marks">${escapeHtml(appMarks)}</td>
      <td>
        <button class="btn btn-primary btn-save">Save</button>
        <button class="btn btn-ghost btn-delete">Delete</button>
      </td>
    `;
    
    tbody.appendChild(row);
    
    // Add event listeners
    row.querySelector('.btn-approve').addEventListener('click', () => setPaymentStatus(app.roll, 'Approved'));
    row.querySelector('.btn-reject').addEventListener('click', () => setPaymentStatus(app.roll, 'Rejected'));
    row.querySelector('.btn-delete').addEventListener('click', () => deleteApplication(app.roll));
    row.querySelector('.btn-save').addEventListener('click', () => saveRowChanges(row, app.roll));
  });
}

function setPaymentStatus(roll, status){
  let apps = readApps();
  const index = apps.findIndex(a => a.roll === roll);
  
  if(index !== -1){
    apps[index].paymentStatus = status;
    saveApps(apps);
    loadAdminData();
    renderAppsList();
    
    const student = apps[index];
    showToast(`Payment ${status.toLowerCase()} for ${student.name}`);
  }
}

function deleteApplication(roll){
  if(!confirm('Are you sure you want to delete this application?')) return;
  
  let apps = readApps();
  apps = apps.filter(a => a.roll !== roll);
  saveApps(apps);
  
  let marks = readMarks();
  marks = marks.filter(m => m.rollNumber !== roll);
  saveMarks(marks);
  
  loadAdminData();
  renderAppsList();
  showToast('Application deleted');
}

function saveRowChanges(row, roll){
  let apps = readApps();
  const index = apps.findIndex(a => a.roll === roll);
  
  if(index !== -1){
    const cells = row.querySelectorAll('[contenteditable="true"]');
    cells.forEach(cell => {
      const field = cell.getAttribute('data-field');
      const value = cell.textContent.trim();
      
      if(field === 'marks'){
        let marks = readMarks();
        marks = marks.filter(m => m.rollNumber !== roll);
        
        if(value){
          const markValues = value.split(',').map(m => m.trim()).filter(m => m);
          markValues.forEach(mark => {
            marks.push({ rollNumber: roll, marks: Number(mark) });
          });
        }
        
        saveMarks(marks);
      } else {
        apps[index][field] = value;
      }
    });
    
    saveApps(apps);
    showToast('Changes saved for ' + apps[index].name);
  }
}

/* ------------------ MARKS UPLOAD ------------------ */
q('marksForm').addEventListener('submit', function(e){
  e.preventDefault();
  if(q('marksPass').value === ADMIN_PASSWORD){
    q('marksForm').classList.add('hidden');
    q('marksArea').classList.remove('hidden');
    showToast('Marks upload access granted');
  } else {
    alert('Wrong password!');
  }
});

q('saveMarksBtn').addEventListener('click', function(){
  const roll = q('marks_roll').value.trim();
  const marksValue = q('marks_value').value;
  
  if(!roll || marksValue === ''){
    alert('Enter roll number and marks');
    return;
  }
  
  const apps = readApps();
  if(!apps.find(a => a.roll === roll)){
    alert('Roll number not found');
    return;
  }
  
  let marks = readMarks();
  marks.push({ rollNumber: roll, marks: Number(marksValue) });
  saveMarks(marks);
  
  showToast('Marks uploaded for roll ' + roll);
  q('marks_roll').value = '';
  q('marks_value').value = '';
});

/* ------------------ INITIALIZATION ------------------ */
document.addEventListener('DOMContentLoaded', function(){
  renderAppsList();
  console.log('Portal loaded successfully');
  console.log('Applications in storage:', readApps().length);
});
</script>
</body>
</html>